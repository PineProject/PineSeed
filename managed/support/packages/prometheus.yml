# Copyright (c) YugaByte, Inc.

# This is a template for auto-generated file for prometheus configuration

global:
 # By default, scrape targets every 15 seconds.
 scrape_interval:     15s
 evaluation_interval: 15s
 # scrape_timeout is set to the global default (10s).

 # The labels to add to any time series or alerts when communicating with
 # external systems (federation, remote storage, Alertmanager).
 external_labels:
   monitor: 'swamper'


# A list of scrape configurations.
scrape_configs:

 - job_name: 'prometheus'
   scrape_interval: 10s
   scrape_timeout:  10s
   static_configs:
     - targets: ['localhost:9090']

 - job_name: "node"
   file_sd_configs:
     - files:
       - '/opt/yugabyte/swamper_targets/node.*.json'
   metric_relabel_configs:
   - source_labels: ["__name__"]
     regex: "(.*)"
     target_label: "saved_name"
     replacement: "$1"

 - job_name: "yugabyte"
   metrics_path: "/prometheus-metrics"
   file_sd_configs:
     - files:
       - '/opt/yugabyte/swamper_targets/yugabyte.*.json'
   metric_relabel_configs:
   - source_labels: ["__name__"]
     regex: "handler_latency_(yb_[^_]*)_([^_]*)_([^_]*)(.*)"
     target_label: "server_type"
     replacement: "$1"
   - source_labels: ["__name__"]
     regex: "handler_latency_(yb_[^_]*)_([^_]*)_([^_]*)(.*)"
     target_label: "service_type"
     replacement: "$2"
   - source_labels: ["__name__"]
     regex: "handler_latency_(yb_[^_]*)_([^_]*)_([^_]*)(_sum|_count)"
     target_label: "service_method"
     replacement: "$3"
   - source_labels: ["__name__"]
     regex: "handler_latency_(yb_[^_]*)_([^_]*)_([^_]*)(_sum|_count)"
     target_label: "__name__"
     replacement: "rpc_latency$4"
   - source_labels: ["__name__"]
     regex: "(.*)"
     target_label: "saved_name"
     replacement: "$1"
